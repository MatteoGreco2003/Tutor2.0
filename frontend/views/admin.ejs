<!DOCTYPE html>
<html lang="it">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin</title>
    <link rel="icon" type="image/x-icon" href="/img/favicon.jpg" />
    <link rel="stylesheet" href="css/admin.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css"
    />
  </head>
  <body>
    <!-- Header -->
    <div class="header">
      <div class="header-left">
        <!-- HAMBURGER MENU SVG -->
        <button class="menu-toggle" aria-label="Toggle menu">
          <svg
            class="hamburger-icon"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <line x1="3" y1="6" x2="21" y2="6"></line>
            <line x1="3" y1="12" x2="21" y2="12"></line>
            <line x1="3" y1="18" x2="21" y2="18"></line>
          </svg>
          <svg
            class="close-icon"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            style="display: none"
          >
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>

        <a
          href="/home-admin"
          class="admin-icon"
          style="text-decoration: none; color: inherit"
          >üë®‚Äçüíº</a
        >
        <a
          href="/home-admin"
          class="header-title"
          style="text-decoration: none; color: inherit"
          >Admin</a
        >
      </div>
      <button class="logout-btn">Disconnettiti</button>
    </div>

    <!-- Main Container -->
    <div class="container">
      <!-- Sidebar -->
      <aside class="sidebar">
        <a href="#" class="sidebar-item active" data-page="home">
          <i class="fas fa-home"></i> Home
        </a>
        <a href="#" class="sidebar-item" data-page="studenti">
          <i class="fas fa-users"></i> Gestione Studenti
        </a>
        <a href="#" class="sidebar-item" data-page="tutor">
          <i class="fas fa-chalkboard-user"></i> Gestione Tutor
        </a>

        <div class="sidebar-footer">
          <div class="outro">
            <p>
              Powered by
              <a href="https://www.toptutor.it/" target="_blank">toptutor.it</a>
            </p>
          </div>
          <div class="sidebar-socials">
            <a href="https://www.instagram.com/toptutor.it/" target="_blank"
              ><i class="fab fa-instagram"></i
            ></a>
          </div>
        </div>
      </aside>

      <!-- Main Content -->
      <main class="main-content">
        <!-- PAGE: HOME (STATISTICHE) -->
        <div class="page" id="page-home">
          <div class="section">
            <h2 class="page-title">Dashboard</h2>

            <!-- Statistiche Cards -->
            <div class="stats-container">
              <div class="stat-card">
                <div class="stat-icon tutor-icon">
                  <i class="fas fa-chalkboard-user"></i>
                </div>
                <div class="stat-content">
                  <h3>Tutor Totali</h3>
                  <p class="stat-number" id="totalTutor">0</p>
                </div>
              </div>

              <div class="stat-card">
                <div class="stat-icon student-icon">
                  <i class="fas fa-graduation-cap"></i>
                </div>
                <div class="stat-content">
                  <h3>Studenti Totali</h3>
                  <p class="stat-number" id="totalStudenti">0</p>
                </div>
              </div>

              <div class="stat-card">
                <div class="stat-icon active-icon">
                  <i class="fas fa-fire"></i>
                </div>
                <div class="stat-content">
                  <h3>Tutor Attivi (almeno uno studente)</h3>
                  <p class="stat-number" id="activeTutorCount">0</p>
                </div>
              </div>
            </div>

            <!-- Quick Actions -->
            <div class="quick-actions">
              <h3>Azioni Rapide</h3>
              <div class="actions-grid">
                <button class="action-btn" data-action="view-studenti">
                  <i class="fas fa-eye"></i>
                  <span>Visualizza Studenti</span>
                </button>

                <button class="action-btn" data-action="view-tutor">
                  <i class="fas fa-list"></i>
                  <span>Visualizza Tutor</span>
                </button>
              </div>
            </div>
          </div>

          <div class="section">
            <!-- Ultimi Aggiunti -->
            <div class="recent-section">
              <h3>Ultimi Utenti Aggiunti</h3>

              <div class="recent-container">
                <!-- Ultimi Tutor -->
                <div class="recent-card">
                  <h4><i class="fas fa-chalkboard-user"></i> Ultimi Tutor</h4>
                  <div class="recent-list" id="recentTutorList">
                    <p class="empty-state-small">Caricamento...</p>
                  </div>
                </div>

                <!-- Ultimi Studenti -->
                <div class="recent-card">
                  <h4><i class="fas fa-graduation-cap"></i> Ultimi Studenti</h4>
                  <div class="recent-list" id="recentStudentiList">
                    <p class="empty-state-small">Caricamento...</p>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="section">
            <!-- Grafici Sezione -->
            <div class="charts-section">
              <h3>Analitiche</h3>
              <div class="charts-container">
                <!-- Chart Studenti per Grado -->
                <div class="chart-card">
                  <h4>Studenti per Grado Scolastico</h4>
                  <canvas id="gradoChart"></canvas>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- PAGE: GESTIONE STUDENTI -->
        <div class="page" id="page-studenti" style="display: none">
          <div class="section">
            <div class="section-header">
              <h2 class="page-title">Gestione Studenti</h2>
              <div class="filters-group">
                <!-- Filtro Grado Scolastico -->
                <select id="filterGrado" class="filter-select">
                  <option value="">üéì Tutti i gradi</option>
                  <option value="Elementari">Elementari</option>
                  <option value="Medie">Medie</option>
                  <option value="Superiori">Superiori</option>
                </select>

                <!-- Ricerca Nome/Email -->
                <div class="search-box">
                  <input
                    type="text"
                    id="searchStudenti"
                    placeholder="üîç Cerca per nome o email..."
                  />
                </div>
              </div>
            </div>

            <!-- Tabella Studenti -->
            <div class="table-container">
              <table class="admin-table">
                <thead>
                  <tr>
                    <th>Nome</th>
                    <th>Cognome</th>
                    <th>Email</th>
                    <th>Grado Scolastico</th>
                    <th>Data Iscrizione</th>
                    <th>Azioni</th>
                  </tr>
                </thead>
                <tbody id="studenteTableBody">
                  <!-- Questo verr√† riempito da JS -->
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- PAGE: GESTIONE TUTOR -->
        <div class="page" id="page-tutor" style="display: none">
          <div class="section">
            <div class="section-header">
              <h2 class="page-title">Gestione Tutor</h2>
              <div class="header-right">
                <!-- Ricerca Nome/Email -->
                <div class="search-box">
                  <input
                    type="text"
                    id="searchTutor"
                    placeholder="üîç Cerca per nome o email..."
                  />
                </div>
                <button id="createTutorBtn" class="add-btn">
                  <i class="fas fa-plus"></i> Crea Tutor
                </button>
              </div>
            </div>

            <!-- Tabella Tutor -->
            <div class="table-container">
              <table class="admin-table">
                <thead>
                  <tr>
                    <th>Nome</th>
                    <th>Cognome</th>
                    <th>Email</th>
                    <th>Studenti Associati</th>
                    <th>Data Iscrizione</th>
                    <th>Azioni</th>
                  </tr>
                </thead>
                <tbody id="tutorTableBody">
                  <tr>
                    <td colspan="6" style="text-align: center; padding: 40px">
                      <i class="fas fa-spinner fa-spin"></i> Caricamento...
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </main>
    </div>

    <!-- MODAL: CREA NUOVO TUTOR -->
    <div id="createTutorModal" class="modal">
      <div class="modal-content">
        <span class="close" id="closeCreateTutor">&times;</span>
        <h2>Crea Nuovo Tutor</h2>

        <form id="createTutorForm" class="modal-body" novalidate>
          <div class="input-box">
            <input type="text" id="tutorNome" placeholder="Nome" required />
            <i class="fa-solid fa-user"></i>
          </div>
          <div class="input-box">
            <input
              type="text"
              id="tutorCognome"
              placeholder="Cognome"
              required
            />
            <i class="fa-solid fa-user"></i>
          </div>

          <!-- RIGA 2: EMAIL -->
          <div class="input-box">
            <input type="email" id="tutorEmail" placeholder="Email" required />
            <i class="fa-solid fa-envelope"></i>
          </div>

          <!-- RIGA 3: PASSWORD -->
          <div class="input-box password-input-box">
            <input
              type="password"
              id="tutorPassword"
              placeholder="Password"
              required
            />
            <i
              class="fa-solid fa-lock toggle-password"
              data-input="tutorPassword"
            ></i>
          </div>

          <!-- RIGA 4: CONFERMA PASSWORD -->
          <div class="input-box password-input-box">
            <input
              type="password"
              id="tutorConfirmPassword"
              placeholder="Conferma Password"
              required
            />
            <i
              class="fa-solid fa-lock toggle-password"
              data-input="tutorConfirmPassword"
            ></i>
          </div>

          <!-- CONTAINER ERRORI -->
          <div id="tutorErrors" class="error-messages"></div>

          <!-- PULSANTI -->
          <div class="modal-footer">
            <button
              type="submit"
              id="submitCreateTutor"
              class="add-btn"
              style="flex: 1"
            >
              Crea Tutor
            </button>
            <button type="button" id="cancelCreateTutor" class="btn-annulla">
              Annulla
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- MODAL: VISUALIZZA PROFILO TUTOR -->
    <div id="viewTutorModal" class="modal">
      <div class="modal-content">
        <span class="close" id="closeViewTutor">&times;</span>
        <h2 id="modalTutorProfileTitle">Profilo Tutor</h2>

        <div class="modal-body">
          <!-- SEZIONE 1: DATI PERSONALI -->
          <div class="profile-section">
            <h3>Dati Personali</h3>
            <div class="profile-grid">
              <!-- RIGA 1: Nome e Cognome -->
              <div class="profile-field">
                <label>Nome</label>
                <p id="profile-tutor-nome">-</p>
              </div>
              <div class="profile-field">
                <label>Cognome</label>
                <p id="profile-tutor-cognome">-</p>
              </div>
            </div>

            <!-- RIGA 2: Email -->
            <div class="profile-field">
              <label>Email</label>
              <p id="profile-tutor-email">-</p>
            </div>
          </div>

          <!-- SEZIONE 2: STUDENTI ASSOCIATI -->
          <div class="profile-section">
            <h3>Studenti Associati</h3>
            <div id="profile-tutor-studenti" class="studenti-list">
              <p class="empty-state-small">Nessuno studente associato</p>
            </div>
          </div>
        </div>

        <div class="modal-footer">
          <button id="closeViewTutorBtn" class="btn-close">Chiudi</button>
        </div>
      </div>
    </div>

    <!-- MODAL: Assegna Studente a Tutor -->
    <div id="assegnaStudenteModal" class="modal">
      <div class="modal-content">
        <span class="close" id="closeAssegnaStudente">&times;</span>
        <h2>Assegna Studente</h2>
        <form id="assegnaStudenteForm" novalidate>
          <div style="margin-bottom: 16px">
            <label for="selectStudente">Scegli Studente</label>
            <select
              id="selectStudente"
              name="studenteID"
              size="4"
              required
            ></select>
          </div>

          <div
            id="assegnaStudenteError"
            class="error-msg"
            style="display: none; margin-bottom: 12px"
          ></div>

          <div style="display: flex; gap: 14px; margin-top: 20px">
            <button type="submit" class="plan-btn" style="margin: 0">
              Assegna Studente
            </button>
            <button
              type="button"
              class="btn-annulla"
              id="cancelAssegnaStudente"
            >
              Annulla
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- MODAL: Rimuovi Studente da Tutor -->
    <div id="rimuoviStudenteModal" class="modal">
      <div class="modal-content">
        <span class="close" id="closeRimuoviStudente">&times;</span>
        <h2>Rimuovi Studente</h2>
        <form id="rimuoviStudenteForm" novalidate>
          <div style="margin-bottom: 16px">
            <label for="selectStudenteRimuovi"
              >Scegli Studente da Rimuovere</label
            >
            <select
              id="selectStudenteRimuovi"
              name="studenteID"
              size="4"
              required
            ></select>
          </div>

          <div
            id="rimuoviStudenteError"
            class="error-msg"
            style="display: none; margin-bottom: 12px"
          ></div>

          <div style="display: flex; gap: 14px; margin-top: 20px">
            <button type="submit" class="plan-btn" style="margin: 0">
              Rimuovi Studente Associato
            </button>
            <button
              type="button"
              class="btn-annulla"
              id="cancelRimuoviStudente"
            >
              Annulla
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- MODAL: VISUALIZZA PROFILO STUDENTE -->
    <div id="viewStudenteModal" class="modal">
      <div class="modal-content">
        <span class="close" id="closeViewStudente">&times;</span>
        <h2 id="modalProfileTitle">Profilo Studente</h2>

        <div class="modal-body">
          <!-- SEZIONE 1: DATI PERSONALI -->
          <div class="profile-section">
            <h3>Dati Personali</h3>
            <div class="profile-grid">
              <!-- RIGA 1: Nome, Cognome, Telefono -->
              <div class="profile-field">
                <label>Nome</label>
                <p id="profile-nome">-</p>
              </div>
              <div class="profile-field">
                <label>Cognome</label>
                <p id="profile-cognome">-</p>
              </div>
              <div class="profile-field">
                <label>Telefono</label>
                <p id="profile-telefono">-</p>
              </div>

              <!-- RIGA 2: Grado e Indirizzo Scolastico -->
              <div class="profile-field">
                <label>Grado Scolastico</label>
                <p id="profile-grado-scolastico">-</p>
              </div>
              <div class="profile-field">
                <label>Indirizzo Scolastico</label>
                <p id="profile-indirizzo-scolastico">-</p>
              </div>
            </div>
          </div>

          <!-- SEZIONE 2: DATI FAMIGLIA -->
          <div class="profile-section">
            <h3>Dati Famiglia</h3>
            <div class="profile-grid">
              <!-- RIGA 1: Genitore 1 (Nome, Cognome, Telefono) -->
              <div class="profile-field">
                <label>Genitore 1 - Nome</label>
                <p id="profile-genitore1-nome">-</p>
              </div>
              <div class="profile-field">
                <label>Genitore 1 - Cognome</label>
                <p id="profile-genitore1-cognome">-</p>
              </div>
              <div class="profile-field">
                <label>Genitore 1 - Telefono</label>
                <p id="profile-genitore1-telefono">-</p>
              </div>

              <!-- RIGA 2: Genitore 2 (Nome, Cognome, Telefono) -->
              <div class="profile-field">
                <label>Genitore 2 - Nome</label>
                <p id="profile-genitore2-nome">-</p>
              </div>
              <div class="profile-field">
                <label>Genitore 2 - Cognome</label>
                <p id="profile-genitore2-cognome">-</p>
              </div>
              <div class="profile-field">
                <label>Genitore 2 - Telefono</label>
                <p id="profile-genitore2-telefono">-</p>
              </div>

              <!-- RIGA 3: Email Famiglia -->
              <div class="profile-field">
                <label>Email Famiglia</label>
                <p id="profile-email-famiglia">-</p>
              </div>
            </div>
          </div>

          <!-- SEZIONE 3: DATI SCUOLA -->
          <div class="profile-section">
            <h3>Dati Scuola</h3>
            <div class="profile-field">
              <label>Email Professori</label>
              <div id="profile-email-professori">
                <p>-</p>
              </div>
            </div>
          </div>
        </div>

        <div class="modal-footer">
          <button id="closeViewStudenteBtn" class="btn-close">Chiudi</button>
        </div>
      </div>
    </div>

    <!-- MODAL: Elimina Studente -->
    <div id="deleteStudenteModal" class="modal">
      <div class="modal-content">
        <span class="close" id="closeDeleteStudente">&times;</span>
        <h2>Elimina Studente</h2>
        <p>
          Sei sicuro di voler eliminare questo studente?<br />
          <b>Questa azione non pu√≤ essere annullata.</b>
        </p>
        <div style="display: flex; gap: 14px; margin-top: 20px">
          <button
            id="confirmDeleteStudente"
            class="delete-btn"
            style="margin: 0"
          >
            Elimina Studente
          </button>
          <button id="cancelDeleteStudente" class="btn-annulla">Annulla</button>
        </div>
      </div>
    </div>

    <!-- MODAL: Elimina Tutor -->
    <div id="deleteTutorModal" class="modal">
      <div class="modal-content">
        <span class="close" id="closeDeleteTutor">&times;</span>
        <h2>Elimina Tutor</h2>
        <p>
          Sei sicuro di voler eliminare il tutor
          <strong id="deleteName"></strong>?
          <br />

          Questa azione non pu√≤ essere annullata.
        </p>

        <div class="modal-footer">
          <button type="button" id="confirmDeleteTutor" class="delete-btn">
            Elimina Tutor
          </button>
          <button type="button" id="cancelDeleteTutor" class="btn-annulla">
            Annulla
          </button>
        </div>
      </div>
    </div>
  </body>

  <!-- Chart.js Library -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

  <script src="/js/api.js"></script>
  <script src="/js/admin-core.js"></script>
  <script src="/js/admin-home.js"></script>
  <script src="/js/admin-studenti.js"></script>
  <script src="/js/admin-tutor.js"></script>
</html>
